# Deferred Features: Foundation-First Approach (Learning Focus)

AI Agent, guide the human developer in implementing the "window-spaces" and foundational code for deferred features (from SSD Section 3.3). Emphasize Flutter-specific patterns for extensibility. Each feature must be conditionally rendered or activated via a conceptual feature flag mechanism.

3.1. General Principles for Deferred Features in Flutter
Feature Flag Simulation: Since a remote feature flag service is not an MVP, advise using a local config/feature_flags.dart file with boolean constants to simulate feature flags.
// lib/config/feature_flags.dart
class FeatureFlags {
  static const bool conversationEvolution = false;
  static const bool imageUploads = false;
  static const bool pushNotifications = true; // Foundation true
  static const bool profilePictures = false;
  static const bool locationBasedFeatures = true; // Foundation true
  static const bool userProfileEditing = false;
}

UI Placeholders: For UI-related deferred features, create actual Flutter widgets that are either hidden (Offstage or Visibility widget) or disabled (AbsorbPointer wrapping the widget, or a disabled Button).
Convex Schema: Guide on extending the Convex schema (Convex/schema.ts) to include necessary fields for future features (e.g., conversationId, imageUrl). This is a backend definition, so only remind the developer here.
No Active Logic: Do not implement active functionality for these features in the MVP. Focus solely on the "window-space" (UI placeholders) and backend schema definitions.

3.2. Specific Deferred Features (Flutter Implementation Guidance)
3.2.1. Conversation Evolution (FR-DEFER-001)
Guidance: In the WhisperCard widget, conditionally render an OutlinedButton or TextButton labeled "Echo Back" if FeatureFlags.conversationEvolution is true. This button should be visually distinct (e.g., faded color) and show a Tooltip or SnackBar indicating "Coming Soon" when pressed.
Convex Schema: Remind developer to ensure conversations table and conversationId field in whispers are defined in the backend Convex schema.
3.2.2. Image Uploads (FR-DEFER-002)
Guidance (Whisper Content): In the ComposeWhisper widget, conditionally render an IconButton (e.g., Icons.image_outlined) for "Attach Image" if FeatureFlags.imageUploads is true. This button should be disabled (onPressed: null) or show a "Coming Soon" Tooltip.
Guidance (Profile Pictures): Create a basic "Profile" page (features/authentication/presentation/pages/ProfilePage.dart). Conditionally render a CircleAvatar placeholder with an IconButton (e.g., Icons.camera_alt_outlined) overlaid, disabled if FeatureFlags.profilePictures is true.
Convex Schema: Remind developer to ensure imageUrl in whispers and profileImageUrl in users tables are defined in the backend Convex schema.
3.2.3. User Profile Management (FR-DEFER-003)
Guidance: On the "Profile" page, display the user's displayName and username as Text widgets (read-only for MVP). If FeatureFlags.userProfileEditing is true, display an ElevatedButton labeled "Edit Profile" which is disabled (onPressed: null) or shows a "Coming Soon" Tooltip.
Convex Schema: Remind developer to ensure bio field is present in users table in the backend Convex schema.
3.2.4. Push Notifications (FR-DEFER-004)
Guidance: Integrate the firebase_messaging package (if using Firebase for notifications, or a similar platform-agnostic notification package).
Guide on adding firebase_messaging to pubspec.yaml.
Instruct on requesting notification permissions using FirebaseMessaging.instance.requestPermission().
Demonstrate obtaining the device's FCM token (FirebaseMessaging.instance.getToken()).
Instruct on sending this token to Convex (via ConvexClient mutation) to be stored in the users table (pushNotificationToken field).
Feature Flag: FeatureFlags.pushNotifications (set to true for foundation, false for active sending). No actual notification display or handling logic for incoming notifications in the app is required for MVP.
Convex Schema: Remind developer to ensure pushNotificationToken field in users table is defined in the backend Convex schema.
3.2.5. Location-Based Features (FR-DEFER-005)
Guidance: Integrate the geolocator package.
Guide on adding geolocator to pubspec.yaml.
Instruct on requesting location permissions using Geolocator.requestPermission().
No actual location sharing UI is required for MVP. If a placeholder is desired, a subtle, inactive IconButton (e.g., Icons.location_on_outlined) can be conditionally rendered in the ComposeWhisper component if FeatureFlags.locationBasedFeatures is true.
Feature Flag: FeatureFlags.locationBasedFeatures (set to true for foundation, false for active use).
Convex Schema: Remind developer to ensure location field (object: {latitude: number, longitude: number}) is present in whispers table in the backend Convex schema.
