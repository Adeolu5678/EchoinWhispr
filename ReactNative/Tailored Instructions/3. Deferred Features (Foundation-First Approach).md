# Deferred Features (Foundation-First Approach)

AI Agent, for the following deferred features (from SSD Section 3.3), implement the "window-spaces" and foundational code. Each feature must be conditionally rendered or activated via its corresponding feature flag from config/featureFlags.ts.

3.1. General Principles for Deferred Features
Feature Flag Check: All UI elements, routes, or logic related to these features must be wrapped in an if (FEATURE_FLAGS.FEATURE_NAME) check.
UI Placeholders: For UI-related deferred features, create a visually distinct, but inactive or hidden, placeholder element. For example, a disabled Button or an Icon that does nothing on press. These should use Tailwind for styling.
Convex Schema: Ensure the shared Convex/schema.ts file includes the necessary fields for these future features (e.g., conversationId in whispers, imageUrl in whispers and users). AI agents should only read from this schema definition.
No Active Logic: Do not implement active functionality for these features in the MVP. Focus solely on the "window-space" (UI placeholders) and backend schema definitions.

3.2. Specific Deferred Features
3.2.1. Conversation Evolution (FR-DEFER-001)
Feature Flag: FEATURE_FLAGS.CONVERSATION_EVOLUTION
UI: In the WhisperCard component, conditionally render a visually disabled "Echo Back" TouchableOpacity or Button if FEATURE_FLAGS.CONVERSATION_EVOLUTION is true. This button should have a onPress handler that displays a custom toast notification "Feature Coming Soon!"
Convex Schema: (Already handled in Convex/schema.ts).
3.2.2. Image Uploads (FR-DEFER-002)
Feature Flags: FEATURE_FLAGS.IMAGE_UPLOADS, FEATURE_FLAGS.PROFILE_PICTURES
UI (Whisper Content): In the ComposeWhisper component, conditionally render an inactive/disabled TouchableOpacity or IconButton (e.g., using Ionicons or MaterialIcons) for "Attach Image" if FEATURE_FLAGS.IMAGE_UPLOADS is true. Its onPress should display a custom toast notification "Feature Coming Soon!".
UI (Profile Pictures): Create a basic "Profile" screen (app/(tabs)/profile.tsx or similar). Conditionally render a circular image placeholder (e.g., Image component with a default placeholder URL) with an inactive "Upload Photo" TouchableOpacity overlaid if FEATURE_FLAGS.PROFILE_PICTURES is true. Its onPress should display a custom toast notification "Feature Coming Soon!". This profile page should also display the user's displayName and username.
Convex Schema: (Already handled in Convex/schema.ts).
Contingency: If AI agents encounter recurrent or complex errors during the foundation implementation of these UI placeholders and schema extensions, communicate this. If deemed unresolvable quickly, the "window-space" can be removed entirely for the MVP to prioritize a lean release. This decision will be logged in the AI Agent Logbook.
3.2.3. User Profile Management (FR-DEFER-003)
Feature Flag: FEATURE_FLAGS.USER_PROFILE_EDITING
UI: On the "Profile" screen, display the user's displayName and username as read-only Text components. If FEATURE_FLAGS.USER_PROFILE_EDITING is true, display a visually disabled "Edit Profile" TouchableOpacity or Button. Its onPress should display a custom toast notification "Feature Coming Soon!".
Convex Schema: (Already handled in Convex/schema.ts).
3.2.4. Push Notifications (FR-DEFER-004)
Feature Flag: FEATURE_FLAGS.PUSH_NOTIFICATIONS
Foundation Logic: If FEATURE_FLAGS.PUSH_NOTIFICATIONS is true:
Integrate expo-notifications.
In the main application component (app/_layout.tsx or app/(tabs)/_layout.tsx), implement logic to:
Request notification permissions from the user.
If permissions are granted, obtain the device's push notification token (Notifications.getExpoPushTokenAsync()).
Call a Convex mutation (api.users.storePushToken) to send and store this token in the users table (pushNotificationToken field) for the currently authenticated user.
No actual notification sending or display handling for incoming notifications logic is required for MVP.
Convex Mutation (api.users.storePushToken):
This mutation will be defined in Convex/functions.ts and will:
Require ctx.auth.userId to be present.
Accept pushToken (string).
Update the pushNotificationToken field for the user matching ctx.auth.userId in the users table.
Convex Schema: (Already handled in Convex/schema.ts).
3.2.5. Location-Based Features (FR-DEFER-005)
Feature Flag: FEATURE_FLAGS.LOCATION_BASED_FEATURES
Foundation Logic: If FEATURE_FLAGS.LOCATION_BASED_FEATURES is true:
Integrate expo-location.
In a background service or on an appropriate screen, implement logic to request location permissions from the user. No active location sharing or tracking is required for MVP. The purpose is to set up the permission flow.
UI: For the MVP, no direct UI for location sharing is required. If a placeholder is desired, a subtle, inactive icon (e.g., a map pin from Ionicons) could be conditionally rendered in the ComposeWhisper component if the flag is true. Its onPress should display a custom toast notification "Feature Coming Soon!".
Convex Schema: (Already handled in Convex/schema.ts).
