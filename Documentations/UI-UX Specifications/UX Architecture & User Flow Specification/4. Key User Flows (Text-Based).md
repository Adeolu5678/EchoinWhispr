Flow 1: New User Onboarding & Persona Creation
Goal: To get a new user (like Sarah) from landing on the dApp to having a searchable profile.
Steps:
User opens dApp.
System displays [Screen: Connect Wallet].
User clicks "Connect Wallet" (triggers WalletConnect).
User scans/approves in their wallet.
System connects and reads user's Hedera Account ID.
System calls getPersona(user_address) to check isInitialized.
Contract returns isInitialized == false.
System displays [Screen: Create Persona].
User fills in "Career," "Interests," and "Current Mood."
System (client-side) generates publicKey and mailHash.
User clicks "Create Persona".
System prompts wallet to sign the registerUser(...) transaction.
User signs.
System shows a "Creating your on-chain persona..." loading state.
Transaction confirms.
System displays [Screen: Main Dashboard] (showing the "Search" tab).
Flow Complete.
Flow 2: Search, Discover, & Initiate "Whisper" (w/ Paywall)
Goal: To let a user (like Devin) find a persona and send a new "Whisper," encountering the "lax" paywall.
Steps:
User is on [Screen: Main Dashboard].
User clicks the "Search" navigation icon.
System navigates to [Screen: Search & Filter].
System displays "Syncing user directory..." progress bar.
Sync completes. The search/filter inputs become active.
User types "UI/UX Designer" into "Career".
System (client-side) filters the downloaded list.
System displays matching persona cards.
User clicks on a persona.
System displays [Screen: View Persona & Send Whisper].
User types a message and clicks "Send Whisper."
System checks checkSubscription(devin_address).
Result: false (User is on free tier).
System (client-side) checks local storage: getDailyWhisperCount().
System branches logic:
Case A (Limit Not Reached): dailyWhisperCount < 5
System proceeds: Encrypts msg, uploads to IPFS, prompts wallet for HCS submit.
System increments local count: setDailyWhisperCount(count + 1).
System shows "Whisper Sent!" confirmation.
Flow Complete.
Case B (Limit Reached): dailyWhisperCount >= 5
System displays [Screen: Daily Limit Reached].
User can "Subscribe" or "Wait".
If User subscribes (e.g., subscribeWithHBAR()), they are returned to the message, which sends automatically.
Flow Complete.
Flow 3: Receive, Read, & Reply
Goal: To let a user (like Alex) safely receive, read, and reply to a new "Whisper."
Steps:
User (Alex) logs in.
User clicks the "Inbox" navigation icon.
System displays [Screen: Inbox].
System shows a temporary loading state: "Please, wait while your messages are being updated..."
Sync completes. A new HCS message matching Alex's mailHash has been processed.
System displays the Inbox tabs: "Chats" and "Requests (1)".
User clicks "Requests (1)".
User sees the new "Whisper" from "Anonymous Persona".
User clicks the Whisper.
System displays [Screen: Whisper Request].
User reads the message. They have two options:
Option A: Click the "Back" icon (ignore). The message remains in "Requests."
Option B: Click the "Accept" button.
System (on "Accept") moves this conversation (by convo_id) from the "Requests" list to the "Chats" list.
System navigates to [Screen: Conversation View].
User types a reply: "Thanks!"
User clicks "Send."
System (client-side) executes the reply workflow (encrypt, upload, HCS submit).
No subscription check is needed (replies are free).
Flow Complete.
